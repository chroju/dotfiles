---
description: 現在のブランチからPRを作成。テンプレートと最近のPRから言語・形式を判定
argument-hint: "[省略可: PRタイトルまたは説明のヒント]"
allowed-tools: Bash(git status:*), Bash(git diff:*), Bash(git branch:*), Bash(git log:*), Bash(gh pr list:*), Bash(gh pr create:*), Read, Glob, Skill(commit)
---

# タスク

現在のブランチから Pull Request を作成する。

## コミット状態の確認

1. **未コミットの変更を確認**
   - `git status` で未コミットの変更（staged/unstaged）を確認
   - 変更がある場合:
     - ユーザーに「コミットしていない変更があります。先にコミットしますか？」と確認
     - Yes の場合: `/commit` コマンドを実行してからPR作成に進む
     - No の場合: そのままPR作成に進む（未コミット変更は含まれない）

## 前提条件の確認

2. 現在のブランチを確認
   - `main` または `master` ブランチにいる場合はエラーを表示して終了
   - リモートブランチが存在しない場合は `git push -u origin <current-branch>` を実行

## PR内容の生成

3. **変更内容の分析**
   - `git log <base-branch>..HEAD` でコミット履歴を確認（全コミット）
   - `git diff <base-branch>...HEAD` で差分の全体像を把握
   - **注意**: 最新のコミットだけでなく、ブランチの全コミットを分析対象とする

4. **PRテンプレートの確認**
   - 以下の場所を順に確認:
     - `PULL_REQUEST_TEMPLATE.md`
     - `.github/PULL_REQUEST_TEMPLATE.md`
     - `.github/PULL_REQUEST_TEMPLATE/*.md` (複数テンプレート)
   - 複数テンプレートがある場合:
     - ファイル名から適切なものを推測（例: feature.md, bugfix.md）
     - 判断できない場合はユーザーに質問
   - テンプレートがない場合: 簡潔で構造化された本文を生成

5. **言語の判定**
   - デフォルトは英語
   - `gh pr list --limit 3` で最新3件のPRを確認
   - タイトルまたは本文が日本語なら日本語を使用

6. **PRタイトルと本文の生成**
   - タイトル: ブランチ全体の変更を要約（50文字以内推奨）
   - 本文:
     - テンプレートがある場合: テンプレートに従って記入
     - テンプレートがない場合:
       ```
       ## Summary
       - 変更の概要を箇条書き（2-5項目）

       ## Changes
       - 主要な変更内容

       ## Test Plan
       - テスト方法や確認項目
       ```
   - `$ARGUMENTS` が指定された場合、それをタイトル・本文生成のヒントとして使用

## PRの作成

7. **`gh pr create` を実行**
   - タイトルと本文を使用してPRを作成
   - フォーマット例:
     ```bash
     gh pr create --title "タイトル" --body "$(cat <<'EOF'
     本文内容
     EOF
     )"
     ```

8. **結果の表示**
   - 作成されたPR URLを表示
   - エラーが発生した場合はユーザーに報告

## 注意事項

- **コミット確認を最優先**: PR作成前に必ず未コミット変更の有無を確認
- **全コミットを分析**: 最新コミットだけでなく、ブランチ分岐以降の全コミットを分析してPR内容を生成
- **リモートへのpush**: リモートブランチが存在しない場合は自動的にpushする
- **ドラフトPR**: 必要に応じて `--draft` オプションを使用（ユーザーに確認）
- **base branch**: 通常は `main` だが、リポジトリ設定に応じて `master` や他のブランチを使用

## 実行ステップ

1. 未コミット変更の確認と `/commit` 実行（必要な場合）
2. 現在のブランチとリモート状態を確認
3. PRテンプレートの存在確認
4. 最新3件のPRから言語を判定
5. ブランチ全体のコミット履歴と差分を分析
6. PRタイトルと本文を生成
7. リモートへpush（必要な場合）
8. `gh pr create` でPR作成
9. PR URLを表示
